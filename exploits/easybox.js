var easyBox = {};

/**
 * Generate the default Password
 * @param  {string} mac MAC-Address of the target EasyBox
 * @return {object}     The SSID and WPA-Key
 */
easyBox.getPassPhraseForMac = function (mac) {
	mac = mac.replace(/:/g, "");
	mac = mac.replace(/-/g, "");
	mac = mac.replace(/ /g, "");

	if (mac.length == 12){
		C1 = ""+ parseInt(mac.substring(8), 16);

		while (C1.length < 5) C1 = 0+C1;

		S6 = parseInt(C1.charAt(0),16);
		S7 = parseInt(C1.charAt(1),16);
		S8 = parseInt(C1.charAt(2),16);
		S9 = parseInt(C1.charAt(3),16);
		S10 = parseInt(C1.charAt(4),16);
		M7 = parseInt(mac.charAt(6),16);
		M8 = parseInt(mac.charAt(7),16);
		M9 = parseInt(mac.charAt(8),16);
		M10 = parseInt(mac.charAt(9),16);
		M11 = parseInt(mac.charAt(10),16);
		M12 = parseInt(mac.charAt(11),16);

		K1 = (S7+S8+M11+M12) & (0x0F);
		K2 = (M9+M10+S9+S10) & (0x0F);

		X1 = K1^S10;
		X2 = K1^S9;
		X3 = K1^S8;
		Y1 = K2^M10;
		Y2 = K2^M11;
		Y3 = K2^M12;
		Z1 = M11^S10;
		Z2 = M12^S9;
		Z3 = K1^K2;

		return {
			'ssid': 'EasyBox-' + M7.toString(16) + M8.toString(16) + M9.toString(16) + M10.toString(16) + S6.toString(16) + S10.toString(16),
			'wpaKey': X1.toString(16)+Y1.toString(16)+Z1.toString(16)+X2.toString(16)+Y2.toString(16)+Z2.toString(16)+X3.toString(16)+Y3.toString(16)+Z3.toString(16)
		};
	} else {
		return null;
	}
};

module.exports = easyBox;
